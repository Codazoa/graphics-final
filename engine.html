<!DOCTYPE html>
<html lang="en">
<head>
    <title>cs442-graphics-engine</title>
    <style media="screen">
        #the-canvas {border: 1px solid darkblue}
    </style>
</head>
<body>
    <canvas id="the-canvas" width="800" height="800"></canvas>
    <script src="lib.js"></script>
    <script src="matrix_template.js"></script>
    <script src="vector_template.js"></script>

    <script>

        // ##########################################################
        // ##
        // ##   Matrix and Vector testing Code
        // ##

        const rot_xz = Mat4.rotation_xz( .25 );
        const rot_xy = Mat4.rotation_xy( .25 );
        const rot_yz = Mat4.rotation_yz( .25 );
        const translate = Mat4.translation( 4, 3, 5 );
        const scale = Mat4.scale( 2, 3, 4 );
        const mul = scale.mul( translate );
        const vec = new Vec4( 1, 2, 0.5, 1 );
                    
        console.log( 'Quarter turn XZ rotation: ', rot_xz.toString() ); 
        console.log( 'Quarter turn XY rotation: ', rot_xy.toString() ); 
        console.log( 'Quarter turn YZ rotation: ', rot_yz.toString() ); 
        console.log( 'Translate by 4, 3, 5: ', translate.toString() );
        console.log( 'Scale by 2, 3, 4: ', scale.toString() );
        console.log( 'Translate and then scale: ', mul.toString() );
        console.log( 'Transform a vector with the preceding matrix: ', 
            mul.transform_vec(vec).toString() );


        const vec2 = new Vec4( 3, 6, 9, 1 );
        const scaled = vec.scaled( 10 );
        const dot = vec.dot( vec2 );
        const length = vec2.length();
        const norm = vec2.norm();
        const add = vec.add( vec2 );
                    
        console.log( 'Vector multiplied by scaler: ' , scaled.toString() );
        console.log( 'Vector dot vector: ', dot.toString() );
        console.log( 'Vector length: ', length );
        console.log( 'Vector norm: ', norm.toString() );
        console.log( 'Vector add: ', add.toString() );

        // ##########################################################
        // ##
        // ##   Matrix and Vector testing Code End
        // ##


        // ##########################################################
        // ##
        // ##   Hello Colors Code
        // ##

        let canvas = document.getElementById('the-canvas');

        /** @type {WebGLRenderingContext} */
        let gl = canvas.getContext('webgl2');

        // create vertex interleaved color array
        // x0,y0,z0,r0,g0,b0,a0,
        // x1,y1,z1,r1,g1,b1,a1,...
        // Need to match colors of top right and bot left vertex
        let verts = [
            -0.5,0.5,0,1,1,0.25,1,
            0.5,0.5,0,0,0,1,1,
            -0.5,-0.5,0,1,0,0,1,
            0.5,0.5,0,0,0,1,1,
            -0.5,-0.5,0,1,0,0,1,
            0.5,-0.5,0,0,1,0,1
        ]


        // create and bind the buffer before we start drawing
        let vertex_buffer = create_and_load_vertex_buffer(gl, verts, gl.STATIC_DRAW);

        // vertex shader
        let vertex_source =
        `   #version 300 es
            precision mediump float;

            in vec3 coordinates;
            in vec4 color;

            out vec4 v_color;

            void main(void){
                gl_Position = vec4( coordinates, 1.0 );
                v_color = color;
            }
        `;
        
        // fragment shader
        let fragment_source =
        `   #version 300 es
            precision mediump float;

            in vec4 v_color;

            out vec4 f_color;

            void main(void){
                f_color = v_color;
            }
        `;
        
        // compile shaders and activate the shader program
        let shader_program = create_compile_and_link_program( gl, vertex_source, fragment_source );
        gl.useProgram( shader_program );

        // set buffer for vertex coordinates
        // 3 coordinate values with 4 * 7 byte stride, coordinates start at 0
        set_vertex_attrib_to_buffer(
            gl, shader_program,
            "coordinates",
            vertex_buffer, 3,
            gl.FLOAT, false, 4 * 7, 0
        );

        // set buffer for vertex colors
        // 4 color values with 4 * 7 byte stride, colors start 4 * 3 bytes into array
        set_vertex_attrib_to_buffer(
            gl, shader_program,
            "color",
            vertex_buffer, 4,
            gl.FLOAT, false, 4 * 7, 4 * 3 
        );

        // setting various render settings
        set_render_params( gl );

        // clear screen
        gl.clear( gl.COLOR_BUFFER_BIT );

        // draw the triangles to the screen
        // 6 vertecies to draw
        gl.drawArrays( gl.TRIANGLES, 0, 6 );

        delete_program_and_attached_shaders( gl, shader_program );
        gl.deleteBuffer( vertex_buffer );

        // ##########################################################
        // ##
        // ##   Hello Colors Code end
        // ##



    </script>
    
</body>
</html>